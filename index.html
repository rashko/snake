<html>

<head>
    <title>Snake game</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
            text-align: center;
        }
        .container {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }
        #start {
            margin-top: 20px;
            padding: 5px 10px;
            font-size: 20px;
            border: none;
            border-radius: 3px;
            background-color: blue;
            color: #ffffff;
        }

        #snake {
            border: solid 1px #ccc;
            
        }

        .cube {
            width: 20px;
            height: 20px;
            float: left;
            box-sizing: border-box;
            border: solid 1px #cccccc;
        }

        .cube.snake {
            background-color: blue;
        }
    </style>
</head>

<div>
    <div class="container">
        <div class="controls">
            <button id="start">Start Game</button>
            <h1 id="title"></h1>
            <h3 id="levelTitle">
                <span id="level"></span>
                <span id="score"></span>
            </h3>
        </div>
        <div id="snake"></div>
    </div>

    <script type="text/javascript">
        class Snake {
            constructor(name) {
                this.container = document.getElementById('snake');
                this.debug = document.getElementById('debug');
                this.startButton = document.getElementById('start');
                this.title = document.getElementById('title');
                this.levelTitle = document.getElementById('level');
                this.scoreTitle = document.getElementById('score');
                this.name = name;
                this.matrixSize = 15;
                this.matrix = [];
                this.snakeSize = 8;
                this.snake = [];
                this.direction = 'right';
                this.interval = undefined;
                this.speed = 300;
                this.level = 1;
                this.moveCount = 0;
                this.changeCount = 0;
                this.score = 0;
                this.tail = undefined;
                this.init();
            }

            createMatrix() {
                this.container.setAttribute("style", `width: ${this.matrixSize * 20}px; height: ${this.matrixSize * 20}px`)
                var row;
                for (var x = 0; x < this.matrixSize; x++) {
                    row = [];
                    for (var y = 0; y < this.matrixSize; y++) {
                        var cube = document.createElement('div')
                        cube.className = 'cube';
                        this.container.appendChild(cube);
                        row.push(cube);
                    }
                    this.matrix.push(row);
                }
            }
            increeseSnake(x, y) {
                var el = this.matrix[x][y];
                el.classList.add('snake');
                this.snake.push({ el, pos: { x, y } });
            }
            createSnake() {
                var x = 4, y = 4;
                this.snake = [];
                for (var i = 0; i < this.snakeSize; i++) {
                    this.increeseSnake(x, y);
                    switch (this.direction) {
                        case 'left': y--; break;
                        case 'right': y++; break;
                        case 'top': x--; break;
                        case 'bottom': x++; break;
                    }
                }
            }

            setupControls() {
                document.addEventListener('keydown', (event) => {
                    const keyName = event.key;
                    switch (keyName) {
                        case 'ArrowRight': this.direction = 'right'; break;
                        case 'ArrowLeft': this.direction = 'left'; break;
                        case 'ArrowDown': this.direction = 'down'; break;
                        case 'ArrowUp': this.direction = 'up'; break;
                    }
                    this.changeCount++;
                    if (this.changeCount % 10 === 0) {
                        this.upLevel();
                    }
                });
            }
            upLevel() {
                this.level++;
                this.speed -= 30;
                this.levelTitle.innerText = `level: ${this.level}, `;
                window.clearInterval(this.interval);
                this.interval = window.setInterval(() => this.moveSnake(), this.speed);
                this.snake.unshift(this.tail);
            }

            numberWithCommas(x) {
                return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            }

            updateScore() {
                this.moveCount++;
                this.score = this.score + (this.moveCount * 5 * this.level)
                this.scoreTitle.innerText = `score: ${this.numberWithCommas(this.score)}`;
                if (this.moveCount % 30 === 0) {
                    this.moveCount = 0;
                }
            }

            moveSnake() {
                var { x, y } = { ...this.snake[this.snake.length - 1].pos };
                this.tail = this.snake.shift();
                this.tail.el.classList.remove('snake');
                var head;
                switch (this.direction) {
                    case 'left': y--; break;
                    case 'right': y++; break;
                    case 'down': x++; break;
                    case 'up': x--; break;
                }
                if (
                    x < 0 ||
                    x > this.matrixSize - 1 ||
                    y < 0 ||
                    y > this.matrixSize - 1 ||
                    this.snake.find(o => o.pos.x === x && o.pos.y === y)
                ) {
                    this.gameOver();
                    return false;
                }
                head = this.matrix[x][y];
                head.classList.add('snake');
                this.snake.push({ el: head, pos: { x, y } });
                this.updateScore();
            }

            startGame() {
                this.createSnake();
                this.startButton.hidden = true;
                this.title.innerText = 'game started :-)';
                this.levelTitle.innerText = `level: ${this.level}`;
                this.interval = window.setInterval(() => this.moveSnake(), this.speed);
            }

                

            gameOver() {
                this.startButton.hidden = false;
                this.snake.forEach(cube => cube.el.classList.remove('snake'))
                this.direction = 'right';
                this.title.innerText = 'game over :-(';
                this.level = 1;
                this.speed = 300;
                this.changeCount = 0;
                this.moveCount = 0;
                window.clearInterval(this.interval);
            }

            init() {
                this.createMatrix();
                this.setupControls();
                this.startButton.addEventListener('click', () => this.startGame());
                this.title.innerText = 'Press start';
            }
        }

        const game = new Snake("guy");
        // game.sayHello();
    </script>
    </body>

</html>